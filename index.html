<!-- Smart Kiosk Single Page Application -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Kiosk</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
.page { display: none; padding: 20px; }
.active { display: block; }
header { background-color: #004aad; color: white; text-align: center; padding: 15px; font-size: 1.2rem; }
button { padding: 10px 15px; font-size: 1rem; border: none; border-radius: 8px; background-color: #004aad; color: white; cursor: pointer; width: 100%; margin-top: 10px; }
.container { max-width: 500px; margin: auto; }
input { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
.qr-preview { width: 100%; height: 250px; background: #ddd; display: flex; align-items: center; justify-content: center; border-radius: 10px; position: relative; }
.qr-box { position: absolute; border: 4px solid lime; box-sizing: border-box; display: none; }
.hide { display: none; }
.barcode-box { margin-top: 15px; padding: 10px; border: 1px dashed #004aad; text-align: center; border-radius: 10px; }
</style>
</head>
<body>
<header>Smart Kiosk</header>

<!-- Hidden Admin Unlock -->
<div style="padding:10px; text-align:center;">
<input type="password" id="admin-unlock" placeholder="Enter admin code" onkeypress="checkAdminUnlock(event)" />
</div>

<!-- Home Page -->
<div id="home-page" class="page active">
<div class="container">
<button onclick="navigate('scan-page')">Scan QR</button>
<button onclick="navigate('manual-code-page')">Enter Code Manually</button>
<button onclick="navigate('redeem-page')">Redeem Points</button>
</div>
</div>

<!-- Scan QR Page -->
<div id="scan-page" class="page">
<div class="container">
<h2>Scan QR Code</h2>
<div class="qr-preview" id="qr-preview">Camera Loading...
<div class="qr-box" id="qr-box"></div>
</div>
<button onclick="navigate('home-page')">Back</button>
</div>
</div>

<!-- Manual Code Page -->
<div id="manual-code-page" class="page">
<div class="container">
<h2>Enter Code</h2>
<input type="text" id="manual-code" maxlength="6" placeholder="Enter code" />
<button onclick="submitCode()">Submit</button>
<button onclick="navigate('home-page')">Back</button>
</div>
</div>

<!-- Redeem Page -->
<div id="redeem-page" class="page">
<div class="container">
<h2>Redeem Points</h2>
<input type="text" id="redeem-input" placeholder="Enter voucher code" />
<button onclick="redeem()">Redeem</button>
<div id="barcode-section" class="barcode-box"></div>
<button onclick="navigate('home-page')">Back</button>
</div>
</div>

<!-- Admin Section -->
<div id="admin-page" class="page hide" style="padding:20px;">
<h2>Admin Section</h2>
<input type="number" id="admin-qr-points" placeholder="Points" />
<button onclick="generateQR()">Generate QR</button>
<input type="text" id="admin-text-code" placeholder="Text code" />
<button onclick="generateTextCode()">Generate Text Code</button>
<div id="admin-output" style="margin-top:15px;"></div>
<button onclick="navigate('home-page')">Back to Home</button>
</div>

<script>
let qrScanned = false;
function navigate(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    if(pageId==='scan-page') startScanner();
}

// QR Scanner Simulation
function startScanner() {
    qrScanned = false;
    const box = document.getElementById('qr-box');
    box.style.display = 'block';
    setTimeout(() => {
        if(!qrScanned){
            onQRScanned('SAMPLEQR123');
        }
    }, 2000); // simulate scanning
}

function onQRScanned(data) {
    if(qrScanned) return;
    qrScanned = true;
    alert('QR Scanned: '+data);
}

function submitCode() {
    const input = document.getElementById('manual-code');
    if(input.value.trim()===''){alert('Enter code'); return;}
    alert('Code submitted: '+input.value);
    input.value='';
}

function redeem() {
    const input = document.getElementById('redeem-input');
    if(input.value.trim()===''){alert('Enter voucher code'); return;}
    if(!confirm('Confirm redeem?')) return;
    const barcodeSection = document.getElementById('barcode-section');
    const newBarcode = document.createElement('div');
    const code = 'BC'+Math.floor(Math.random()*1000000000);
    newBarcode.innerHTML = `<p><strong>Redeemed:</strong> ${input.value}</p>
<img src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${code}' alt='Barcode'>
<p>Code: ${code}</p>
<button onclick="copyBarcode('${code}')">Copy</button>
<a href='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${code}' download>Download</a>
<hr>`;
    barcodeSection.appendChild(newBarcode);
    input.value='';
}

function copyBarcode(code){navigator.clipboard.writeText(code); alert('Copied '+code);}

// Admin unlock
function checkAdminUnlock(event){
    if(event.key==='Enter'){
        const code=document.getElementById('admin-unlock').value;
        if(code==='gimme250k'){document.getElementById('admin-page').classList.remove('hide'); document.getElementById('admin-unlock').value='';}
        else{alert('Incorrect admin code');}
    }
}

function generateQR(){
    const points=document.getElementById('admin-qr-points').value || 100;
    const qrDiv=document.getElementById('admin-output');
    const code='BTD-'+points+'-'+Date.now();
    qrDiv.innerHTML=`<p>QR Generated: ${code}</p><img src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${code}' alt='QR'>`;
}

function generateTextCode(){
    const txt=document.getElementById('admin-text-code').value || 'ADMINCODE';
    const qrDiv=document.getElementById('admin-output');
    qrDiv.innerHTML=`<p>Text Code Generated: ${txt}</p>`;
}
</script>
</body>
</html>
